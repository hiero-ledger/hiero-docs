# 交易记录

## 理解交易记录 - 汇款和费用

一旦某项交易被Hedera 网络成功地处理成一个协商一致的状态， 网络节点为该交易分别创建一个“记录”或“收据”，显示其状态和影响。

交易记录中信息的一个关键组成部分是交易如何改变Hedera账户中涉及的余额。 账户余额可能会因某笔交易而发生变化，这要么是由于收费(支付或收到)，要么是由于某些其他有意的转账，我们在这里将其称为“汇款”。

### 账户余额

提交给Hedera 的每笔交易都会导致一组账户余额的变化 - 要么是因为：

1. 交易直接指向需要更改的特定余额，例如，Alice使用加密转移器发送了1000个hbars到Bob 。
2. 这笔交易间接造成余额的变化，例如执行合同通话导致HBAR从Smart Contract的帐户发送给他人。
3. 交易处理为协商一致状态以及这种改变状态的持续存在都要支付费用。
4. 在比默认时间更长的时间内支付该交易的“记录”费用。

由于上述任何原因，交易可能导致给定账户余额发生变化或 更广泛地说，出于上述各种原因。

通常有五种与交易有关的账户：

1. 发送 — — HBAR正从中发送的账户
2. 接收器——正在发送HBAR的账户
3. 付款人——支付交易相关费用的账户。
4. 网络 — Hedera 帐户，接收用于补偿处理交易的网络费用的组件。
5. 节点 - 任何节点将交易提交到网络以便达成共识的帐户

**备注**

- 对于任何交易，所有账户的转账总额总是等于向所有账户转账的总和。
- 付款人一般不同于发件人或收件人。 然而，典型的情况是，付款人也将是付款人。
- 并非所有交易都有发件人或收件人，因为交易没有汇款方面。 。FileCreate 或 ConsensusSubmitMessage 交易将有费用，但没有相关的汇款。
- 单个CryptoTransfer可以有多个发件人和多个收件人。
- 汇款可以是 HBARs 的 CryptoTransfer 指令的数量， CryptoCreate 的 HBARs 金额将提供给新账户， 或要删除的账户中的HBAR金额，并将这些资金转移到另一个账户。
- 汇款须经这些汇款所有人批准。
- 帐户所有者可以指定转入和转出该帐户的阈值。 如果交易导致一个帐户的阈值被触发， 然后该交易的记录将持续25小时，而不是默认的3分钟。
- 指定阈值的账户所有者将支付阈值费用——不同于交易本身的费用——额外的存储时间。
- 这是帐户0.0。 收取交易费的部分，以补偿所有节点在将交易处理成共识方面所做的工作
- 0.0.98还收取任何阈值记录费用
- 截至2024年2月初，账户号码为31个节点，范围在0.0.3-0.0.469971之间。
- 账户0.0。 8 和节点帐户在收取费用方面是特殊的。 他们还可以发送和接收六溴代二苯，并因此可以成为交易的发送者或接收者。

### Scenarios

我们探索下面的设想情况以及每个账户之间的六种年度年度年度评估报告的流动情况。

#### 案例1-通用性

在最常见的情况下，汇款人向收款人汇款，单独一个帐户支付相关费用。 费用的大小将取决于交易的性质——上传一个大文件将花费不只是简单的加密传输。

这笔费用的金额在账户0.0之间分配。 8 (表示网络的 Hedera 特殊帐户) 和提交交易的特定节点。

![](../../../.gitbook/assets/transaction\_records\_1.png)

#### 案例2-只能收取费用

许多交易不允许明确的汇款，例如FileCreate 或共识提交信息。 就这类交易而言，账户余额的唯一变动将是该项交易的费用。

与以往一样，交易费用在0.0.98与节点之间分配。

![](../../../.gitbook/assets/transaction\_records\_2.png)

#### 案例3-发件人账户支付费用

通常情况下，汇款人向收款人汇款的加密转账费由汇款人支付。 在这种情况下，汇款人的余额将减少汇款和手续费。

原则上，收款人也可以支付费用。

![](../../../.gitbook/assets/transaction\_records\_3.png)

#### 案例4 - 发件人帐户有一个跨越的阈值

账户所有者可以为其账户指定阈值，以便超过这些阈值的账户转账将导致创建的记录持续25小时而不是默认的3分钟。 规定门槛值的帐户将为记录的这种长时间储存支付门槛费用。

在这个例子中，对发送账户指定了门槛值，因此支付这笔门槛值的是该账户。 该账户的余额因此减少了汇款和门槛费用。

帐号98接收网络和服务的总和以及这个门槛费用。

此处没有显示出，但如果汇款人支付了交易费(见上文)，汇款人账户余额将减少汇款金额， 交易费和此阈值。

![](../../../.gitbook/assets/transaction\_records\_4.png)

#### 判例5-收款人账户有一个跨越的阈值

接收账户也可以设置一个阈值集， 如果超过正在转入账户的六溴代二苯数量，将导致记录储存25小时。

门槛记录对收款人特别有用，因为收款人可能不知道汇给他们的汇款，因为他们不一定参与交易的签署。 如同发送者的情况一样。 寿命较长的门槛记录使账户所有人能够每天查询他们在过去24小时内收到的任何汇款和他们可能不知道的所有汇款。

接收账户将为记录的这个较长的储存期支付相关的门槛费用。

因此，接收账户的净余额变动是汇款减去门槛费用。

账户98接收网络、服务和门槛费用之和。

交易费不受已支付的门槛费影响。

如果汇款价值低于门槛价，交易将失败。

![](../../../.gitbook/assets/transaction\_records\_5.png)

#### 案例6 - 节点账户是接收器

节点可能会像任何其他Hedera账户一样收到汇款。

作为一个具体的例子，客户端通过在查询中包含一个 CryptoTransfer 即可补偿对查询的响应， 当提交到网络时，将用适当的汇款补偿该节点。

在这种情况下， 节点帐户余额将会增加它收到的用于处理CryptoTransfer 以及支付该节点查询响应的实际汇款的总和。

![](../../../.gitbook/assets/transaction\_records\_6.png)

### 交易记录

Hedera Mainnet节点处理后，交易会变成协商一致状态。 详细信息将在节点创建和提供的“交易记录”中发布到外部世界。 客户检索记录并分析数据以核实交易的后果。 例如，指派的协商一致的时间戳以及相关账户余额如何因交易而变化。

当从镜像节点而不是主网检索时，导致某项记录的交易也是可用的。 因此，正是这种综合数据结构为分析和区分汇款和收费提供了最丰富的一套信息。

信息流动情况如下：

![](../../../.gitbook/assets/transaction\_records\_7.png)

检索交易及其相关记录的客户可能想要区分汇款和交易的规费部分，即： 账户余额变化的一部分是由于交易费用造成的。 什么部分来自门槛费，什么部分来自汇款。

交易和相应记录相结合有足够的信息，使客户能够对每个账户作出明确区分。

交易记录有一个传输列表数据结构，描述HBAR是如何由于交易而在账户之间移动的。

在 R3 (2020年2月10日更新之前发布) 版本的节点软件。 交易所涉及的每个账户可能有多次转账。 例如，可能会有单独的转账，表明0.0.98账户收取费用，这将增加到正确的总费用。

此外，在 R3 中

1. 每次转账是否超过了每个账户的阈值。 因此，如果门槛值定得很低，单个账户支付汇款和收费就可以支付多个门槛记录。
2. R3格式的转让顺序不可预测。

我们更改了R4中记录转移列表格式(2月10日发布) • 处理上述问题并使其更加一致和简洁的节点软件。

在R4版本中，记录转移列表只显示每个相关账户的一个或多个交易类型的单个净转移。

现在将转入/转出账户的阈值与该净转账进行比较。 而不是按总净额计算的组成转移部分。 因此，任何账户只支付一次门槛费用，而不是多次。 这对用户来说更便宜。

下面显示R3和R4之间的变动，涉及帐户0.0的代表性交易。 002汇寄10 000个锡亚尔酒吧到账户0.0.1001，而汇款人和收款人的账户上设定了1 000个锡亚酒吧的门槛。

由于汇款价值超过这些极限，汇款人和收款人都将支付门槛费用。

**R3**

![](../../../.gitbook/assets/r3.jpg)

**R4**

![](../../../.gitbook/assets/r4.jpg)

在 R4 格式， 记录转账列表不再有不同账户的多次转账——每个账户只有一个转账，其值反映了影响到每个账户的各种转账的总和。

虽然R4格式比R3格式更简洁， 一些客户可能想要确定组件转移——即打破汇款， 节点费用、阈值费用和其他交易费用。 便利进行这一分析， Hedera 计划为镜像节点 REST API 添加支持，以允许客户端请求默认的综合传输列表。 或者转而是逐项的转让列表(类似于R3格式)。
