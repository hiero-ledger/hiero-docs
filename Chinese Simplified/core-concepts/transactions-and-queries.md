---
description: Hedera API 交易和查询概述
---

# 交易和查询

## 交易记录

**交易** 是客户端向某个节点发送的请求，期望它们被提交到网络以便处理成协商一致的订单，然后应用到状态。 每笔交易(例如`TokenCreateTransaction()`)\`都有一个相关的交易费用，用于补偿Hedera网络的处理和随后以协商一致的状态维护。 用户可以为用户愿意花费的金额设置最大交易费用。 用户只收取实际交易费用。

**交易 ID**

每个交易都有一个唯一的交易ID。 交易ID用于：

- 获取收据、记录、国家证据
- 内部检测重复交易时的网络

事务ID是通过交易的有效启动时间和支付交易的账户ID组成的。 交易的有效启动时间是交易开始在网络上处理的时间。 交易的有效开始时间可以设置为未来的日期/时间。 交易ID看起来像`0.0.9401@1598924675.825000`where `0.0.9401` 是交易费支付者帐户ID，`1598924675.825000` 是`seconds.nanoseconds`中的时间戳。

交易有效持续时间最长为180秒，并在交易有效开始时间开始。 这意味着交易最多需要180秒才能被网络中的节点之一接受。 如果交易在这个时间范围内不被接受，交易将过期。 交易必须被创建、签名并再次提交。

**交易**一般包括以下内容：

- **节点帐户**：交易被发送到节点的帐户(如：`0.0.3`)
- **交易ID**：交易的标识符包含两个组件，即支付账户的账户ID，加上交易的有效启动时间
- **交易费用**：支付帐户愿意为交易支付的最大费用
- **有效期**：客户希望交易被视为有效的秒数，交易开始有效的时间开始时间
- **Memo**：最多100字节数据字符串(可选)
- **交易**：请求类型，例如HBAR传输或智能合同调用
- **签名**：支付账户至少会以授权方式在交易上签字。 其他签字也可能存在。

Hedera 生态系统中交易的生命周期从客户创建交易时开始。 一旦创建交易，它将由支付交易相关费用的帐户至少以加密方式签名。 可能需要额外的签名，这取决于为帐户、主题或令牌设置的属性。 客户能够规定它愿意为处理交易支付的最高费用； 智能合同操作，最大气体量。 一旦所需的签名被应用到交易中，客户端就会将交易提交给Hedera网络上的任何节点。

接收节点验证(例如确认支付账户有足够的余额来支付费用)，如果验证成功的话。 将交易提交给Hedera网络以便达成共识，将交易添加到一个事件中，并将该事件隐藏到另一个节点。 很快，这个事件会流向所有其他节点。 网络通过[关于gossip 协议的gossip ]（hashgraph-consenstis-algorithms/gosip-about-gosip.md）以指数速度接收此交易。 每个节点独立计算网络节点收到事件的时间中位数，算出事件的一致时间戳（以及内部的交易）。 You may find more information on how the consensus timestamp is calculated [here](https://docs.hedera.com/docs/hashgraph-overview#section-fair-timestamps). 散列图算法提供了最终的共识。 一旦分配了协商一致的时间戳，交易就会按照每个交易的协商一致时间戳所确定的顺序适用于协商一致状态。 届时还处理交易费用。 这样，网络中的每个节点都保持一个共识状态，因为它们都按照同样的顺序应用相同的交易。 每个节点还创建并临时保存收据/记录，以支持客户端随后查询交易状态。

### 嵌套交易

**嵌套交易** 在执行顶级交易后触发后续交易。 用户提交的顶级交易是 **父交易** 。 母交易由于母交易的执行而触发的每一项随后交易都是 **子交易** 。 嵌套交易的一个例子是用户向账户别名提交顶级转账交易，触发账户在幕后创建交易。 这种家长/儿童交易关系也与Hedera合同与HTS预编程序交互。 父交易支持最多999个子交易，因为平台为用户提交的交易保留1000个纳米。

**交易 IDs**

父交易和子交易共享付款人账户ID和有效的启动时间戳。 儿童交易 ID还有一个额外的 **无** 值代表执行儿童交易的顺序。 父交易的nonce 值为0。 由于父交易而执行的每个子交易的零一次递增值。

Parent Transaction ID: <mark style="color:red;">payerAccountId</mark>@<mark style="color:blue;">transactionValidStart</mark>

Child Transaction ID: <mark style="color:red;">payerAccountId</mark>@<mark style="color:blue;">transactionValidStart</mark>/<mark style="color:green;">nonce</mark>

示例：

- Parent Transaction ID: <mark style="color:red;">0.0.2252</mark>@<mark style="color:blue;">1640119571.329880313</mark>
- Child 1 Transaction ID: <mark style="color:red;">0.0.2252</mark>@<mark style="color:blue;">1640119571.329880313</mark>/<mark style="color:green;">1</mark>
- Child 2 Transaction ID: <mark style="color:red;">0.0.2252</mark>@<mark style="color:blue;">1640119571.329880313</mark>/<mark style="color:green;">2</mark>

**交易记录**

通过请求父交易的记录并将 `setInclude(<value>)` 设置为真来返回嵌套交易记录。 这将返回与父交易相关联的所有子交易记录。 儿童交易记录包括父母协商一致的时间戳和儿童交易 ID。

子交易记录中的父共识时间戳字段在触发子交易之前**在父交易之前**未填写时未填写。 此案例的一个例子是使用账户别名创建一个账户。 用户提交转账交易以使用账户别名创建新账户并为其提供资金。 转账交易(父) 触发账户创建交易(子项)。 然而，儿童交易发生在父交易之前，因此在完成转账之前创建新帐户。 上级达成共识的时间戳在这种情况下没有填写。

**交易收据**

可以通过请求母交易收据并设置布尔值等于真以退回所有子交易收据来退回嵌套交易收据。

**子交易费**

儿童交易的交易费用列入母交易记录。 交易费用将在子交易中返回零。

## 查询

**查询** 只由发送到的单个节点处理。 客户端发送查询以检索当前共识状态的某些方面，如账户余额。 某些查询是免费的，但通常需要付费。 完整的查询列表可以找到 [here](../sdks-and-apis/sdks/queries.md)。

查询包括一个包含正常的 HBAR 传输交易的信头，作为客户端支付相应费用的手段。 没有办法向一个节点支付部分付款以处理查询，即如果用户为查询多付，用户将不会收到退款。 处理查询的节点将向网络提交付款交易以便处理成为协商一致的报表，以便收取费用。

客户端可以通过首先询问一个节点的成本而不是实际数据来确定查询的适当费用。 此种COST\_ANSWER查询对客户端是免费的。

For more information about query fees, please visit Hedera API fees [overview](https://www.hedera.com/fees).

### 回顾：

{% hint style="info" %}
回收站

Hedera 没有**矿物** 或特殊的节点群，负责将交易添加到分类账中，如其他分散的分类账解决方法。 每个节点对确定某一事件的协商一致时间戳的影响与其在六溴代二苯中的利害关系相称。
{% endhint %}

![](../.gitbook/assets/transaction-flow.png)

一旦交易被提交到网络，客户可以寻求确认它已成功处理。 有多种确认方法——所提供信息的程度不同。 确认期限、信任程度和相应费用。

![](../.gitbook/assets/query-confirmation.png)

## 确认

- **收据：** 收据提供了最少的信息——仅仅是交易是否已成功处理为协商一致状态。 收据默认情况下生成，持续3分钟。 收据是免费的。
- **记录：** 记录比收据提供更详细的交易信息，例如收到的协商一致的时间戳或智能合同函数调用的结果。 记录默认情况下生成，但持续了3分钟。
- **状态证明(即将到来)：** 查询记录时。 客户端可以选择性地表示它希望网络在记录之外返回状态证明。 国家证明， 这种集体主张包括大部分网络节点的签名。 由于国家证据是由网络的绝大多数加密签名的，因此它们是安全的，并可能在法院得到接受。

{% hint style="info" %}
状态证明的早期版本现在可用. 请查看Mirror Node REST API 部分以开始操作。
{% endhint %}

{% content-ref url="../sdks-and/apis/rest-api.md" %}
[rest-api.md](../sdks-and-apis/rest-api.md)
{% endcontent-ref %}

欲了解更详细的确认方法，请查看[博客文章](https://www.hedera.com/blog/transaction-confirmation-methods-in-hedera)。

## 常见问题

<details>

<summary>与使用Hedera相关的交易和查询费用是什么？</summary>

您可以参考Hedera网站上的费用页面查看交易和查询费用的详细细分。 如果您正在寻找一个估算工具，您可以使用 [Hedera fee estimatator](https://hedera.com/fees)。

</details>

<details>

<summary>交易是什么？</summary>

交易是客户端向某个节点发送的请求，希望它们会被提交到网络以便处理成协商一致的订单，然后应用到状态中。 每个交易都有一个独特的交易ID，由交易的有效启动时间和支付交易的账户ID组成。 这种证件用于获取收据、记录和状态证明，并用于检测提交重复交易的时间。

</details>

<details>

<summary>What are queries?</summary>

查询是由发送到的单个节点处理的请求。 [Clients](../supportand-community/glossary.md#client) 发送查询以检索当前共识状态的某些方面，例如帐户的余额。 某些查询是免费的，但通常需要付费。

</details>

<details>

<summary>收据、记录和状态证明之间的差别是什么？</summary>

收据提供了最低限度的信息——交易是否成功地被处理为协商一致的状态。 记录比收据更详细地介绍交易，例如收到的协商一致的时间戳或智能合同函数调用的结果。 国家证明是一种功能，它可以让客户选择性地表明它希望网络在记录之外返回状态证明。

</details>
