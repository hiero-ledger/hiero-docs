# S√©curit√© des Contrats Intelligents

[Hedera Smart Contract Service (HSCS)](../../support-and-community/glossary. d#hedera-smart-contract-service-hscs) int√®gre les fonctionnalit√©s de la troisi√®me g√©n√©ration de l'entit√© native Hedera ‚Äî haut d√©bit, finalit√© rapide, des frais pr√©visibles et abordables, et un ordre des transactions √©quitable, avec une [machine virtuelle Ethereum (EVM)](. /../support-and-community/glossary.md#ethereum-virtual-machine-evm). Notre objectif est d‚Äôoffrir un support complet pour les contrats intelligents √©crits √† l‚Äôorigine pour d‚Äôautres cha√Ænes compatibles EVM et de permettre leur d√©ploiement harmonieux sur Hedera.

***

## Equivalence EVM

Nous nous effor√ßons de nous assurer que les d√©veloppeurs peuvent facilement pointer vers un point de terminaison RPC support√© par Hedera et effectuer des ex√©cutions et des requ√™tes intelligentes de contrats en utilisant le m√™me code et des outils similaires pour obtenir l'√©quivalence EVM. Toutes les transactions de contrats intelligents sont ex√©cut√©es en utilisant [Besu EVM](../../support-and-community/glossary. d#hyperledger-besu-evm) pour r√©aliser cet objectif et les changements qui en r√©sultent sont stock√©s dans l'arbre Hedera optimis√© [Virtual Merkle](../../support-and-community/glossary.md#virtual-merkle-tree). Les utilisateurs se voient ainsi garantir une finalit√© d√©terministe (par opposition √† la finalit√© probabiliste) des ex√©cutions de contrats intelligents dans les 2-3 secondes tout en s'assurant que les changements d'√©tat sont int√©gralement int√©gr√©s dans les fonctionnalit√©s du contrat intelligent. #x20

{% hint style="info" %}
üîî On peut trouver une ventilation compl√®te des objectifs d'√©quivalence et des exceptions de Hedera's EVM [**ici**](hederas-evm-equivalence-goals-and-exceptions.md).&#x20;
{% endhint %}

***

## Mod√®le de s√©curit√©

### Limites de l'ancien mod√®le (v1)

L'ancien mod√®le de s√©curit√© (avant [0.35.2](https://github.com/hashgraph/hedera-services/releases/tag/v0.35.2)) a pris en charge les signatures de cl√©s de compte fournies au moment de la transaction pour l'autorisation. Certaines des caract√©ristiques cl√©s de ce mod√®le sont :

- [contrats intelligents](../../support-and-community/glossary.md#smart-contract) ne pouvaient que changer leur propre stockage ou le stockage avec lequel ils √©taient [d√©l√©gu√©s appel√©s](https://docs.soliditylang.org/fr/v0.8.19/introduction-to-smart-contracts.html#delegatecall-and-libraries).
- Les contrats intelligents du syst√®me pourraient √™tre appel√©s √† effectuer [Hedera Token Service (HTS)](../../support-and-community/glossary. d#hedera-token-service-hts) op√©rations pour le compte d'un autre compte - Compte poss√©d√© externe (EOA) ou compte contractuel.
- Contrats Intelligents pourrait modifier le stockage d'un EOA avec la signature appropri√©e de la transaction.
- Les contrats intelligents pourraient modifier le solde d‚Äôun EOA avec la signature appropri√©e dans la transaction ou avec un ajout pr√©alable √† une liste d‚Äôapprobation des quotas.

Cette exp√©rience utilisateur grandement am√©lior√©e √©tant donn√© que les contrats peuvent combiner les transactions dans une tentative d'atomicit√©. Par exemple, un contrat peut associer, transf√©rer et approuver des transactions au nom d'un utilisateur avec une seule signature. Tout en se concentrant sur la convivialit√©, cette approche ne traitait pas les cas o√π de mauvais acteurs pouvaient effectuer une transaction non sanctionn√©e pour le compte d'un utilisateur, e. ., [https://hedera. om/blog/analysis-remediation-of-the-precompile-attack-on-the-hedera-network](https://hedera.com/blog/analysis-remediation-of-the-precompile-attack-on-the-hedera-network)

Pour y rem√©dier, les principaux ing√©nieurs de Hedera ont analys√© minutieusement le Service de Contrat Intelligent et les contrats du syst√®me HTS, visant √† s√©curiser les actifs d'√©tat et de jeton des utilisateurs et du r√©seau lors des ex√©cutions des contrats intelligents. Les r√©sultats de cet effort sont les lignes directrices de [Hedera Services version v0.35.2](https://github.com/hashgraph/hedera-services/releases/tag/v0.35.2).

### Limites du nouveau mod√®le (v2)

Dans le nouveau mod√®le de s√©curit√©, les signatures de cl√©s de compte ne peuvent pas fournir d'autorisation pour les actions contractuelles. Ses caract√©ristiques cl√©s incluent :

- Les contrats intelligents ne peuvent changer que leur propre stockage ou le stockage dont ils ont √©t√© [d√©l√©gu√©s appel√©s](https://docs.soliditylang.org/fr/v0.8.19/introduction-to-smart-contracts.html#delegatecall-and-libraries) avec.
- Les contrats intelligents du syst√®me ne peuvent **pas** √™tre appel√©s par un d√©l√©gu√©, sauf √† partir du flux de jetons/facade, par exemple [HIP 719](https://hips.hedera.com/hip/hip-719). Dans de tels cas, les jetons HTS sont repr√©sent√©s comme des contrats intelligents (voir [HIP 218](https://hips.hedera.com/hip/hip-218)) pour les m√©thodes ERC courantes.
- Les contrats intelligents ne peuvent modifier un stockage EOAs que si l'ID du contrat est contenu dans la cl√© EOA.
- Les contrats intelligents peuvent modifier le solde des EOAs s'ils sont approuv√©s pour une provision de jeton pour un jeton sp√©cifique d√©tenu par l'OEE.

#### Tableau de comparaison des limites

<table data-full-width="false"><thead><tr><th width="191">Sp√©cification de la zone</th><th width="238">Mod√®le v1</th><th width="225">Mod√®le v2</th><th align="center">Changement</th></tr></thead><tbody><tr><td>Changements de stockage</td><td>Les contrats intelligents ne peuvent changer que leur propre stockage ou le stockage avec lequel ils ont √©t√© d√©l√©gu√©s</td><td>Les contrats intelligents ne peuvent modifier que leur propre stockage ou le stockage avec lequel ils ont √©t√© d√©l√©gu√©s</td><td align="center"><strong>N</strong></td></tr><tr><td>Types d'appels de contrat syst√®me</td><td>Les contrats intelligents du syst√®me pourraient √™tre d√©l√©gu√©s afin de r√©aliser des op√©rations du service de jetons Hedera au nom d'un autre compte (EOA) ou d'un contrat.</td><td>Les contrats intelligents du syst√®me ne peuvent pas √™tre appel√©s d√©l√©gu√©s, √† l'exception du flux de la fa√ßade du jeton, qui pr√©sente les jetons HTS comme des contrats intelligents pour les m√©thodes ERC courantes.</td><td align="center"><strong>Y</strong></td></tr><tr><td>Changements de stockage du compte autoris√©s</td><td>Contrats Intelligents pourrait modifier le stockage d'un EOA avec la signature appropri√©e de la transaction.</td><td>Les contrats intelligents peuvent modifier un stockage EOAs si l'ID du contrat est contenu dans la cl√© EOA.</td><td align="center"><strong>Y</strong></td></tr><tr><td>Changements du solde du compte autoris√©s</td><td>Les contrats intelligents peuvent changer le solde d'un compte (EOA ou contrat) avec la signature appropri√©e dans la transaction ou avec l'ajout d'une liste de quotas d'approbation</td><td>Les contrats intelligents peuvent modifier le solde des EOAs s'ils ont √©t√© approuv√©s une allocation de jeton.</td><td align="center"><strong>Y</strong></td></tr></tbody></table>

En r√©sum√©, HSCS utilise une approche de s√©curit√© √† trois niveaux :

1. **Niveau 0 - Mod√®le de S√©curit√© EVM :** Les entit√©s ne peuvent modifier que leur propre √©tat et leur propre solde.
2. **Niveau 1 - Mod√®les de s√©curit√© de la valeur du compte ERC :** Le transfert et l'acc√®s √† la valeur du compte suivront les normes d'interface test√©es sur le web3, par exemple ERC20, ERC721.
3. **Niveau 2 - Fonctionnalit√©s avanc√©es de s√©curit√© Hedera :** Les fonctionnalit√©s Hedera uniques peuvent utiliser des autorisations compatibles avec le contrat, par exemple des cl√©s ContractID.

<figure><img src="../../.gitbook/assets/SecurityModel01a.png" alt="" width="188"><figcaption><p>le mod√®le de s√©curit√© √† trois niveaux de contrat intelligent Hedera</p></figcaption></figure>

Pour obtenir un changement d'√©tat ou un transfert de valeur, les ex√©cutions doivent se conformer aux r√®gles de chaque niveau. Les transactions qui ne satisfont pas l'autorisation appropri√©e √©choueront avec les codes de r√©ponse tels que `INVALID_FULL_PREFIX_SIGNATURE_FOR_PRECOMPILE` lorsqu'un exp√©diteur n'est pas autoris√© √† effectuer une op√©ration. Des codes de r√©ponse plus sp√©cifiques aux op√©rations seront retourn√©s, le cas √©ch√©ant, par exemple `SPENDER_DOES_NOT_HAVE_ALLOWANCE`.

***

## Impact sur les d√©veloppeurs

### En tant que d√©veloppeur sur Hedera, que dois-je faire?

Les d√©veloppeurs sont fortement encourag√©s √† tester leurs applications avec de nouveaux contrats et UX en utilisant le nouveau mod√®le de s√©curit√© pour √©viter des cons√©quences involontaires.

- Le nouveau mod√®le de s√©curit√© a √©t√© appliqu√© aux contrats cr√©√©s √† partir de la version principale [0.35.2](../../networks/release-notes/services.md#0.35.2-hedera-smart-contract-service-security-model-changes) et √† partir de la version suivante.
- Les contrats existants d√©ploy√©s avant cette mise √† niveau continueront √† utiliser le mod√®le de s√©curit√© pr√©c√©dent pour une dur√©e limit√©e afin de permettre des modifications d'application/UX.
- Le mod√®le de s√©curit√© pr√©c√©dent ne sera maintenu que pendant environ trois mois. L'objectif actuel est que le r√©seau supprime le mod√®le de s√©curit√© pr√©c√©dent et que tous les contrats suivent le nouveau mod√®le par la publication mainnet de juillet 2023.
- Voir une liste compl√®te des mises √† jour de s√©curit√© faites [here](security.md#0.35.2).&#x20

### Que signifie la modification du mod√®le de s√©curit√© pour les d√©veloppeurs de contrats intelligents ?

La mise √† jour de s√©curit√© implique des modifications des autorisations de l'entit√© pendant l'ex√©cution du contrat lors de la modification de l'√©tat. Bref, les appels de contrat syst√®me (appels de contrats intelligents vers le service de jeton Hedera) ne sont plus ex√©cut√©s avec tous les privil√®ges de l'appelant sup√©rieur, m√™me si l'utilisateur autoris√© fournit une signature.

Il est essentiel de comprendre le processus d‚Äôex√©cution des contrats pour les comptes d√©tenus √† l‚Äôext√©rieur et les contrats pendant les appels r√©guliers et d√©l√©gu√©s. Ce processus implique le suivi de la fa√ßon dont les comptes, l'√©tat (stockage et solde de valeurs) et le code peuvent changer au fur et √† mesure que vous progressez dans la cha√Æne d'appels.

#### Avant (mod√®le v1)

Dans un sc√©nario d‚Äôappel r√©gulier, lorsqu‚Äôun appel est fait pour contracter B, le code de B est ex√©cut√© dans le contexte de son propre √©tat. Cela permet √† B de modifier uniquement son propre √©tat. La valeur de l‚Äôexp√©diteur diff√®re √©galement entre les appels pour souligner que l‚ÄôEOE a fait le premier appel et le premier contrat A fait le second.

<figure><img src="../../.gitbook/assets/SecurityModel02rev - EOA.png" alt=""><figcaption></figcaption></figure>

#### Apr√®s (mod√®le v2)

D‚Äôun autre c√¥t√©, dans un sc√©nario d‚Äôappel d‚Äôoffres d√©l√©gu√©, l‚Äôappel au contrat B voit le code de B ex√©cut√© dans le contexte de l‚Äô√©tat A. Cela permet √† B de modifier l'√©tat de A. Les valeurs de l'exp√©diteur et du destinataire sont conserv√©es depuis le premier appel comme si l'EOE a initi√© l'appel.

<figure><img src="../../.gitbook/assets/SecurityModel03b - EOA.png" alt=""><figcaption></figcaption></figure>

En r√©sum√©, un appel d√©l√©gu√© ex√©cute le code du contrat d'appel dans le contexte du compte pr√©c√©dent, en donnant l'acc√®s au code √† l'√©tat du compte pr√©c√©dent et en brouillant les lignes de la gestion d'√âtat autoris√©e.

En l'appliquant aux modifications du mod√®le de s√©curit√©, le tableau suivant r√©sume les modifications apport√©es √† la v√©rification de l'autorisation.

<table><thead><tr><th width="296">Sc√©nario</th><th width="227">V√©rification d'autorisation</th><th width="107" align="center">Ancien mod√®le</th><th align="center">Nouveau mod√®le</th></tr></thead><tbody><tr><td>Le Smart Contrat A peut changer son propre √©tat en utilisant un appel</td><td>exp√©diteur = Contrat A</td><td align="center">Y</td><td align="center">Y</td></tr><tr><td>Smart Contrat A peut changer l'√©tat de l'EOA par appel</td><td>sender = EOA</td><td align="center">N¬∞</td><td align="center">N¬∞</td></tr><tr><td>Smart Contrat B peut changer l'√©tat du contrat A par appel</td><td>exp√©diteur = A</td><td align="center">N¬∞</td><td align="center">N¬∞</td></tr><tr><td>Smart Contrat A peut changer l'√©tat de l'EOA par appel d√©l√©gu√©</td><td>sender = EOA</td><td align="center">Y</td><td align="center">Y</td></tr><tr><td>Smart Contrat B peut changer l'√©tat du contrat A par appel d√©l√©gu√©</td><td>exp√©diteur = Contrat A</td><td align="center">Y</td><td align="center">Y</td></tr><tr><td>Les contrats intelligents du syst√®me peuvent changer l'√©tat d'un autre compte (EOA ou Contrat A ou Contrat B) par appel</td><td>exp√©diteur = compte</td><td align="center">N¬∞</td><td align="center">N¬∞</td></tr><tr><td>Le contrat intelligent du syst√®me peut changer l'√©tat d'un autre compte EOA ou d'un contrat A ou d'un contrat B) via un appel d√©l√©gu√©</td><td>exp√©diteur = compte</td><td align="center">N¬∞</td><td align="center">N¬∞</td></tr><tr><td><strong>System contracts can change an accounts (EOA or contact A or contract B) state via call with the appropriate signature</strong></td><td><strong>la carte des signatures contient la signature des comptes (EOA ou contacter A ou le contrat B respectivement)</strong></td><td align="center"><strong>Y</strong></td><td align="center"><strong>N</strong></td></tr><tr><td><strong>System smart contract can change another accounts (EOA or contact A or contract B) state via delegate call with the appropriate signature</strong></td><td><strong>la carte des signatures contient la signature des comptes (EOA ou contacter A ou le contrat B)</strong></td><td align="center"><strong>Y</strong></td><td align="center"><strong>N</strong></td></tr><tr><td>Le contrat A ou B peut appeler un contrat syst√®me via un appel</td><td>-</td><td align="center">Y</td><td align="center">Y</td></tr><tr><td><strong>Contract A or B can call a system contract via a delegate call</strong></td><td><strong>-</strong></td><td align="center"><strong>Y</strong></td><td align="center"><strong>N</strong></td></tr></tbody></table>

Au moment du changement, le [contrat syst√®me HTS](https://github.com/hashgraph/hedera-smart-contracts/tree/release/0.3/contracts/hts-precompile) √©tait le seul chemin pour exposer les fonctionnalit√©s de l'API Hedera via des contrats intelligents. √Ä ce titre, il est juste de consid√©rer les diff√©rences entre les mises √† jour du mod√®le de pr√©-s√©curit√© et de post-s√©curit√© lors de l‚Äôobservation des fonctions de changement d'√©tat du contrat du syst√®me HTS.

#### R√©sum√© des impacts du contrat du syst√®me HTS existant

<table data-full-width="false"><thead><tr><th width="212" align="center">Fonction de contrat intelligent du syst√®me IHederaTokenService</th><th width="147" align="center">Exigences d'autorisation mod√®le v1</th><th width="139" align="center">Exigences d'autorisation mod√®le v2</th><th width="96" align="center">Code d'impact</th><th align="center">Solution des d√©veloppeurs</th></tr></thead><tbody><tr><td align="center"><strong>approbation, approbationNFT</strong></td><td align="center">la carte de la signature contient la signature de la cl√© admin</td><td align="center"><code>msg.sender</code> doit √™tre une entit√© √† modifier</td><td align="center">Y</td><td align="center"><p>Mettre √† niveau les contrats</p><p></p><p>ou</p><p></p><p>Mettre √† niveau DApps pour fournir une approbation explicite de l'utilisateur</p><p></p><p><mark style="background-color:yellow;">*Chemins s√©curis√©s suppl√©mentaires :</mark> <a href="https://hips.hedera.com/hip/hip-376"><mark style="background-color:yellow;">HIP 376</mark></a> <mark style="background-color:yellow;">IERC.approve()</mark></p></td></tr><tr><td align="center"><strong>associateToken</strong></td><td align="center">la carte de signature contient la signature de la cl√© d'administration du compte</td><td align="center"><code>msg.sender</code> doit √™tre une entit√© √† modifier</td><td align="center">Y</td><td align="center"><p>Mettre √† niveau les contrats</p><p></p><p>ou </p><p></p><p>Mettre √† niveau DApps pour fournir un associ√© d'utilisateur explicite</p><p></p><p><mark style="background-color:yellow;">*Chemins s√©curis√©s suppl√©mentaires :</mark> <a href="https://hips.hedera.com/hip/hip-719"><mark style="background-color:yellow;">HIP 719</mark></a> <mark style="background-color:yellow;">IHRC.associate()</mark></p></td></tr><tr><td align="center"><strong>burnToken</strong></td><td align="center"><p>la carte de la signature contient la signature de la cl√© de gravure</p><p></p><p>ou</p><p></p><p>L'identifiant du contrat satisfait les exigences de Token.supplyKey</p></td><td align="center">L'identifiant du contrat satisfait les exigences de Token.supplyKey</td><td align="center">Y</td><td align="center">L'administrateur du jeton doit d√©finir le contrat d√©sir√© dans la cl√© fournisseur</td></tr><tr><td align="center"><strong>createFungibleToken, createFungibleTokenWithCustomFees, createNonFungibleToken, createNonFungibleTokenWithCustomFees</strong></td><td align="center"><p>la carte de la signature contient les signatures de cl√© admin affect√©es dans la tr√©sorerie </p><p></p><p>ou </p><p></p><p>Renouveler automatiquement la casse du devoir</p></td><td align="center"><p><code>msg.sender</code> doit √™tre une entit√© √† modifier dans la tr√©sorerie </p><p></p><p>ou </p><p></p><p>Renouveler automatiquement la casse du devoir</p></td><td align="center">Y</td><td align="center">-</td></tr><tr><td align="center"><strong>cryptoTransfer</strong></td><td align="center"><p>la carte de la signature contient la signature de la cl√© admin de l'exp√©diteur </p><p></p><p>ou </p><p></p><p>L'identifiant du contrat satisfait les exigences de Entity.key</p></td><td align="center"><p><code>msg.sender</code> doit √™tre une entit√© √† modifier dans la tr√©sorerie </p><p></p><p>ou </p><p></p><p>Renouveler automatiquement la casse du devoir</p></td><td align="center">Y</td><td align="center">Mettez √† niveau DApps pour fournir une approbation explicite de l'utilisateur.</td></tr><tr><td align="center"><strong>deleteToken</strong></td><td align="center"><p>la carte de la signature contient la signature de la cl√© admin </p><p></p><p>ou </p><p></p><p>L'identifiant du contrat satisfait les exigences de Token.adminKey</p></td><td align="center">L'identifiant du contrat satisfait les exigences de Token.adminKey</td><td align="center">Y</td><td align="center">L'administrateur du jeton doit d√©finir le contrat souhait√© dans la cl√© d'administration</td></tr><tr><td align="center"><strong>dissociateToken, dissociateTokens</strong></td><td align="center">la carte de la signature contient la signature de la cl√© admin</td><td align="center"><code>msg.sender</code> doit √™tre une entit√© √† modifier</td><td align="center">Y</td><td align="center"><p>Mettre √† niveau les contrats</p><p></p><p>ou </p><p></p><p>Mettre √† niveau DApps pour fournir une dissociation explicite de l'utilisateur</p><p></p><p><mark style="background-color:yellow;">*Chemins s√©curis√©s suppl√©mentaires :</mark> <a href="https://hips.hedera.com/hip/hip-719"><mark style="background-color:yellow;">HIP 719</mark></a> <mark style="background-color:yellow;">IHRC.associate()</mark></p></td></tr><tr><td align="center"><strong>freezeToken</strong></td><td align="center"><p>la carte de signature contient la signature de cl√© de blocage </p><p></p><p>ou </p><p></p><p>L'identifiant du contrat satisfait les exigences de Token.freezeKey</p></td><td align="center">L'identifiant du contrat satisfait les exigences de Token.freezeKey</td><td align="center">Y</td><td align="center">L'administrateur du jeton doit d√©finir le contrat souhait√© dans la cl√© de blocage</td></tr><tr><td align="center"><strong>grantTokenKyc</strong></td><td align="center"><p>la carte de la signature contient la signature de la cl√© kyc </p><p></p><p>ou </p><p></p><p>L'identifiant du contrat satisfait les exigences de Token.freezeKey</p></td><td align="center">L'identifiant du contrat satisfait les exigences de Token.kycKey</td><td align="center">Y</td><td align="center">L'administrateur du jeton doit d√©finir le contrat souhait√© dans la cl√© kyc</td></tr><tr><td align="center"><strong>mintToken</strong></td><td align="center"><p>la carte de la signature contient la signature appropri√©e </p><p></p><p>ou </p><p></p><p>L'identifiant du contrat satisfait les exigences de Token.supplyKey</p></td><td align="center">L'identifiant du contrat satisfait les exigences de Token.supplyKey</td><td align="center">Y</td><td align="center">L'administrateur du jeton doit d√©finir le contrat d√©sir√© dans la cl√© fournisseur</td></tr><tr><td align="center"><strong>pauseToken</strong></td><td align="center"><p>la carte de la signature contient la signature de la cl√© en pause </p><p></p><p>ou </p><p></p><p>L'identifiant du contrat satisfait les exigences de Token.pauseKey</p></td><td align="center">L'identifiant du contrat satisfait les exigences de Token.pauseKey</td><td align="center">Y</td><td align="center">L'administrateur du jeton doit d√©finir le contrat souhait√© dans la cl√© de pause</td></tr><tr><td align="center"><strong>revokeTokenKyc</strong></td><td align="center"><p>la carte de la signature contient la signature de la cl√© kyc </p><p></p><p>ou </p><p></p><p>L'identifiant du contrat satisfait les exigences de Token.freezeKey</p></td><td align="center">L'identifiant du contrat satisfait les exigences de Token.kycKey</td><td align="center">Y</td><td align="center">L'administrateur du jeton doit d√©finir le contrat souhait√© dans la cl√© kyc</td></tr><tr><td align="center"><strong>setApprovalForAll</strong></td><td align="center">la carte de la signature contient la signature de la cl√© admin</td><td align="center"><code>msg.sender</code> doit √™tre une entit√© √† modifier</td><td align="center">Y</td><td align="center"><p>Mettre √† niveau les contrats</p><p></p><p>ou</p><p></p><p>Mettre √† niveau DApps pour fournir un associ√© d'utilisateur explicite</p><p></p><p><mark style="background-color:yellow;">*Chemins s√©curis√©s suppl√©mentaires :</mark> <a href="https://hips.hedera.com/hip/hip-376"><mark style="background-color:yellow;">HIP 376</mark></a> <mark style="background-color:yellow;">IERC.setApprovalForAll()</mark></p></td></tr><tr><td align="center"><strong>transfert, transferFromNFT</strong></td><td align="center"><p>la carte de la signature contient la signature de la cl√© admin </p><p></p><p>ou </p><p></p><p>Le D√©pendant doit avoir √©t√© pr√©-approuv√© une allocation</p></td><td align="center"><p><code>msg.sender</code> doit √™tre une entit√© √† modifier dans la tr√©sorerie </p><p></p><p>ou </p><p></p><p>Renouveler automatiquement la casse du devoir</p></td><td align="center">Y</td><td align="center">Mettez √† niveau DApps pour fournir une approbation explicite de l'utilisateur.</td></tr><tr><td align="center"><strong>transferToken, transferTokens, transferNFT, transferNFTs</strong></td><td align="center"><p>la carte de la signature contient la signature de la cl√© admin </p><p></p><p>ou </p><p></p><p>L'identifiant du contrat satisfait les exigences de Entity.key </p><p></p><p>ou </p><p></p><p>Le contrat a √©t√© approuv√© une allocation √† d√©penser par le propri√©taire</p></td><td align="center"><p><code>msg.sender</code> doit √™tre le propri√©taire de l'√©quilibre. </p><p></p><p>Si ce n'est pas 1. L'identifiant du contrat satisfait les exigences de Entity.key </p><p></p><p>ou </p><p></p><p>2. Le contrat a √©t√© approuv√© une allocation √† d√©penser par le propri√©taire</p></td><td align="center">Y</td><td align="center">Mettez √† niveau DApps pour fournir une approbation explicite de l'utilisateur.</td></tr><tr><td align="center"><strong>updateTokenInfo, updateTokenExpiryInfo, updateTokenKeys</strong></td><td align="center"><p>la carte de la signature contient la signature de la cl√© admin </p><p></p><p>ou </p><p></p><p>L'identifiant du contrat satisfait les exigences de Token.adminKey</p></td><td align="center">L'identifiant du contrat satisfait les exigences de Token.adminKey</td><td align="center">Y</td><td align="center">L'administrateur du jeton doit d√©finir le contrat souhait√© dans la cl√© d'administration</td></tr><tr><td align="center"><strong>wipeTokenAccount, wipeTokenAccountNFT</strong></td><td align="center"><p>la carte de signature contient la signature de cl√© d'effacement de jeton </p><p></p><p>ou </p><p></p><p>L'identifiant du contrat satisfait les exigences de Token.wipeKey</p></td><td align="center">L'identifiant du contrat satisfait les exigences de Token.wipeKey</td><td align="center">Y</td><td align="center">L'administrateur du jeton doit d√©finir le contrat d√©sir√© dans la cl√© d'effacement</td></tr><tr><td align="center"><strong>unfreezeToken</strong></td><td align="center"><p>la carte de signature contient la signature de cl√© de blocage de jeton </p><p></p><p>ou </p><p></p><p>L'identifiant du contrat satisfait les exigences de Token.freezeKey</p></td><td align="center">L'identifiant du contrat satisfait les exigences de Token.freezeKey</td><td align="center">Y</td><td align="center">L'administrateur du jeton doit d√©finir le contrat souhait√© dans la cl√© de blocage</td></tr><tr><td align="center"><strong>unpauseToken</strong></td><td align="center"><p>la carte de la signature contient la signature de la cl√© de pause de jeton </p><p></p><p>ou </p><p></p><p>L'identifiant du contrat satisfait les exigences de Token.pauseKey</p></td><td align="center">L'identifiant du contrat satisfait les exigences de Token.pauseKey</td><td align="center">Y</td><td align="center">L'administrateur du jeton doit d√©finir le contrat souhait√© dans la cl√© de pause</td></tr></tbody></table>

{% hint style="info" %}
**Remarque :** Bien que les changements aient un impact sur l'exp√©rience de l'utilisateur, n√©cessitant des √©tapes plus explicites, ils augmentent plus que proportionnellement la s√©curit√© des utilisateurs et des r√©seaux sur toute la plateforme. L'√©quipe continue de pousser avec diligence √† fournir √† la communaut√© des solutions API s√©curis√©es et √©volutives pour leur permettre de construire des dApps cr√©atifs et de tailler leur propre monde partag√© sur le livre.
{% endhint %}

***

## Am√©liorations de s√©curit√©

<details>

<summary>0.35.2</summary>

- Apr√®s l'incident de s√©curit√© le 9 mars, les ing√©nieurs ont effectu√© une analyse approfondie du Service de Contrat Intelligent et des contrats du syst√®me de Token Service Hedera.
- Dans le cadre de cet exercice, nous n'avons pas trouv√© de vuln√©rabilit√©s suppl√©mentaires qui pourraient entra√Æner une attaque que ce que nous avons vu le 9 mars.
- L'√©quipe a √©galement cherch√© des disparit√©s entre les attentes d'un d√©veloppeur de contrats intelligents typique qui est utilis√© pour travailler avec les API de jetons Ethereum (EVM) ou ERC et les comportements des API de contrats du syst√®me de jeton de Hedera. De telles diff√©rences de comportement pourraient √™tre utilis√©es par un d√©veloppeur de contrats intelligents malveillants de mani√®re inattendue.
- Afin d'√©liminer la possibilit√© que ces diff√©rences de comportement soient utilis√©es comme vecteurs d'attaque dans le futur, le logiciel de n≈ìuds de consensus alignera les comportements des contrats du syst√®me de jetons de service de contrats intelligents Hedera avec ceux de EVM et les API de jetons typiques tels que ERC 20 et ERC 721.
- En cons√©quence, les modifications suivantes sont apport√©es depuis la version 0.35.2 du r√©seau principal le 31 mars :
  - Un EOA (compte appartenant √† l'ext√©rieur) devra fournir une approbation ou une provision explicites √† un contrat s'il veut que le contrat transf√®re la valeur du solde de son compte.
  - Le comportement du contrat syst√®me `transferFrom` sera exactement le m√™me que celui de la fonction `transferFrom` ERC 20 et ERC 721 spec `transferFrom`.
  - Pour les fonctionnalit√©s de jetons sp√©cifiques au HTS (par ex. Mettre en pause, congeler ou accorder KYC), un contrat ne sera autoris√© √† ex√©cuter la fonction de gestion de jetons associ√©e que si le ContractId est list√© comme cl√© sur le jeton (i.e. Pause Key, Freeze Key, KYC Key respectivement).
  - Les API `transferToken` et `transferNFT` se comporteront comme `transfer` dans ERC20/721 si l'appelant poss√®de la valeur en cours de transfert, sinon il d√©pendra des quotas de d√©biteurs du propri√©taire du jeton.
  - Le mod√®le ci-dessus dictera les autorisations de l'entit√© (EOA et contrats) pendant l'ex√©cution du contrat lors de la modification de l'√©tat. Les contrats ne s'appuieront plus sur la pr√©sence de signature de la transaction Hedera, mais seront plut√¥t conformes aux mod√®les cl√©s EVM, ERC et ContractId not√©s.
- Dans le cadre de ce communiqu√©, le r√©seau comprendra la logique du grand-p√®re dans les contrats ant√©rieurs.
  - Tous les contrats cr√©√©s √† partir de cette publication utiliseront le mod√®le de s√©curit√© plus strict et, en tant que tel, n'auront pas de consid√©ration pour les signatures de premier niveau sur les transactions pour fournir des autorisations.
  - Les contrats existants d√©ploy√©s avant cette mise √† niveau seront automatiquement mis √† profit et continueront √† utiliser l'ancien mod√®le qui √©tait en place avant cette mise √† jour pour une dur√©e limit√©e afin de permettre aux modifications DApp/UX de travailler avec le nouveau mod√®le de s√©curit√©.
  - La logique du grand-p√®re sera maintenue pendant une p√©riode approximative de 3 mois √† compter de cette publication. Dans une version ult√©rieure en juillet 2023, le r√©seau supprimera la logique du grand-p√®re et tous les contrats suivront le nouveau mod√®le de s√©curit√©.
  - Les d√©veloppeurs sont encourag√©s √† tester leurs DApps avec de nouveaux contrats et UX en utilisant le nouveau mod√®le de s√©curit√© pour √©viter des cons√©quences involontaires. Si aucun d√©veloppeur DApp ne parvient √† modifier ses applications ou √† mettre √† niveau ses contrats (selon le cas) pour adh√©rer au nouveau mod√®le de s√©curit√©. ils peuvent rencontrer des probl√®mes dans leurs applications.

</details>
